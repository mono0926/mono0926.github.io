<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:400,700" rel="stylesheet" type="text/css">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/styles/github.min.css">
<link rel="stylesheet" href="/css/normalize.css">
<link rel="stylesheet" href="/css/skeleton.css">
<link rel="stylesheet" href="/css/custom.css">
<link rel="alternate" href="/index.xml" type="application/rss+xml" title="mono-log">
<title>Ginger APIをPythonで叩いてみた - mono-log</title>
</head>
<body>

<div class="container">

	<header role="banner">
		<div class="header-logo">
			<a href="/"><img src="/images/love.png" width="60" height="60"></a>
		</div>
		
	</header>


	<main role="main">
		<article itemscope itemtype="http://schema.org/BlogPosting">
			<h1 class="entry-title" itemprop="headline">Ginger APIをPythonで叩いてみた</h1>
			<span class="entry-meta"><time itemprop="datePublished" datetime="2013-08-03">August 03, 2013</time></span>
			<section itemprop="entry-text">
				

<p>そんな有名でも無いけど、Gingerという英文作成支援サービスがある。</p>

<p><a href="http://www.itmedia.co.jp/news/articles/1304/24/news120.html">もう前置詞に迷わない」──「ネイティブレベル」の英語が書ける英文チェッカー「Ginger」日本上陸</a>という記事などで4月にニュースになって、この手のものが好きな僕は<a href="https://chrome.google.com/webstore/detail/spell-and-grammar-checker/kdfieneakcjfaiglcfcgkidlkmlijjnh">Chromeの拡張</a>をすぐ導入してみたけど、不必要な時に指摘されたり、必要な時は使い勝手が悪いし、うーんと思ったり。</p>

<h3 id="ginger-api:e8db02c391b5d454a2a2df2488b5a9be">Ginger API</h3>

<p>コマンドラインとかで使いたいなあと思って適当にぐぐったら、<a href="http://blog.livedoor.jp/xaicron/archives/54466736.html">Ginger API を試してみた</a>という記事が。
Gistになぜか<a href="https://gist.github.com/koron/5454500">curlで使ってる例</a>があるみたいで。</p>

<p>GingerのページにはAPIとか無いのになぜだろうと思って、Chromeの開発ツールでリクエストのぞいてみたら、もろにAPI叩いているのがあった。</p>

<p><img src="/images/post/ginger.png" alt="ginger" />
</p>

<blockquote>
<p><a href="http://services.gingersoftware.com/Ginger/correct/json/GingerTheText?callback=C&amp;apiKey=6ae0c3a0-afdc-4532-a810-82ded0054236&amp;lang=US&amp;clientVersion=2.0&amp;text=I+am+programmer.&amp;_1375584239344=">http://services.gingersoftware.com/Ginger/correct/json/GingerTheText?callback=C&amp;apiKey=6ae0c3a0-afdc-4532-a810-82ded0054236&amp;lang=US&amp;clientVersion=2.0&amp;text=I+am+programmer.&amp;_1375584239344=</a></p>
</blockquote>

<!-- more -->

<p>これをブラウザにコピペするとJSONが<code>C()</code>で囲まれたものが出てくるけど、多分JSONP用のパラメーターなので、単にJSON受け取りたい場合は不要。</p>

<p>textパラメーターも適当に削れて、以下でリクエストが可能。
apiKeyとかもろに出てるけどいいのだろうか(　´･‿･｀)</p>

<blockquote>
<p><a href="http://services.gingersoftware.com/Ginger/correct/json/GingerTheText?apiKey=6ae0c3a0-afdc-4532-a810-82ded0054236&amp;lang=US&amp;clientVersion=2.0&amp;text=I+am+programmer">http://services.gingersoftware.com/Ginger/correct/json/GingerTheText?apiKey=6ae0c3a0-afdc-4532-a810-82ded0054236&amp;lang=US&amp;clientVersion=2.0&amp;text=I+am+programmer</a>.</p>

<p>{&ldquo;LightGingerTheTextResult&rdquo;:[{&ldquo;Confidence&rdquo;:4,&ldquo;From&rdquo;:5,&ldquo;LrnFrg&rdquo;:&ldquo;I am programmer&rdquo;,&ldquo;LrnFrgOrigIndxs&rdquo;:[{&ldquo;From&rdquo;:5,&ldquo;To&rdquo;:14}],&ldquo;Mistakes&rdquo;:[{&ldquo;CanAddToDict&rdquo;:false,&ldquo;From&rdquo;:5,&ldquo;To&rdquo;:14}],&ldquo;ShouldReplace&rdquo;:true,&ldquo;Suggestions&rdquo;:[{&ldquo;LrnCatId&rdquo;:12,&ldquo;Text&rdquo;:&ldquo;a programmer&rdquo;},{&ldquo;LrnCatId&rdquo;:13,&ldquo;Text&rdquo;:&ldquo;the programmer&rdquo;}],&ldquo;To&rdquo;:14,&ldquo;TopLrnCatId&rdquo;:12,&ldquo;Type&rdquo;:3,&ldquo;UXFrgFrom&rdquo;:0,&ldquo;UXFrgTo&rdquo;:14}]}</p>
</blockquote>

<p>ざっくりと、間違えている箇所と、その修正例(複数のこともあり)が返ってくる。</p>

<p>と、普通にAPI叩けてしまい、これ使ってよいのだろうかと思いつつ、非公開になったりAPI変わったりすると面倒とか、くらいで私的に使う分には良いのではないかと。
これでサービス作ったり儲けたりすると黒くなってきそうだけど。</p>

<h3 id="実用的な英語のフレーズを表示する-rephrase-という機能:e8db02c391b5d454a2a2df2488b5a9be">実用的な英語のフレーズを表示する「Rephrase」という機能</h3>

<p>上記のやつは単に間違えをしてくれるサービスだけど、さらにより自然な言い回し候補を表示してくれるサービスもあったり。</p>

<p><a href="http://gigazine.net/news/20130802-ginger-rephrase/">英文を文脈に合わせて修正する「Ginger」とネイティブ英語に変換する「Rephrase」</a>に書いてあるとおり<a href="http://www.gingersoftware.com/rephrase_jpn">Rephrase</a>に飛ぶと使える。</p>

<p>こちらも同様の手口で簡単にAPIのURLが取得可能。</p>

<blockquote>
<p><a href="http://ro.gingersoftware.com/rephrase/rephrase?s=Hi%2C%20nice%20to%20meet%20you.&amp;callback=jQuery17204343029616866261_1375585040822&amp;_=1375585300259">http://ro.gingersoftware.com/rephrase/rephrase?s=Hi%2C%20nice%20to%20meet%20you.&amp;callback=jQuery17204343029616866261_1375585040822&amp;_=1375585300259</a></p>
</blockquote>

<p>同じくcalllback云々は不要だけど、さっきはcallback関数名がCだったのにけっこうフォーマットが違ったり、apiKeyが無かったり、base URLが違ったりとかなり適当な感じ（´・ω・｀）</p>

<p>と、英文を入力するとJSONで結果を受け取れるとこまでは行ったので、Pythonで叩いてみた。</p>

<p>大体こんな感じで、修正後の英文や、改善後の候補群に変換するスクリプトが書けた。
最近はWebアクセスはrequestsモジュールを使うのがモダンっぽい。</p>

<p>最新版：<a href="https://github.com/mono0926/AlfredWorkflow/blob/master/ginger/ginger.py">Alfred Workflow</a></p>

<pre><code class="language-python">#!/usr/local/bin/python
# -*- coding: utf-8 -*-
import requests
import json
import sys
import os

class GingerSummary(object):
	&quot;&quot;&quot;Ginger Summary&quot;&quot;&quot;
	def __init__(self, original, results):
		super(GingerSummary, self).__init__()
		self.original = original
		self.results = sorted(results, cmp=lambda x, y: cmp(x.from_, y.from_))
		self.gingered = None

	def process(self):
		if not self.gingered:
			self._ginger()
		return self.gingered;

	def show_detail(self):
		for r in self.results:
			print(r)

	def _ginger(self):
		gingered = self.original
		offset = 0
		for i, r in enumerate(self.results):
			suggest = r.suggestions[0]
			gingered = '{0}{1}{2}'.format(gingered[:r.from_+offset], suggest, gingered[r.to+1+offset:])
			offset += len(suggest) - (r.to - r.from_ + 1)
		self.gingered = gingered


class GingerResult(object):
	&quot;&quot;&quot;Ginger Result&quot;&quot;&quot;
	def __init__(self):
		super(GingerResult, self).__init__()

	@classmethod
	def create_from_json(cls, json):
		that = GingerResult()
		that.from_ = json['From']
		that.to = json['To']
		that.suggestions = [x['Text'] for x in json['Suggestions']]
		that.should_replace = bool(json['ShouldReplace'])
		that.confidence = json['Confidence']
		return that

	def __str__(self):
		return 'from: {0}, to: {1}, suggestions: [{2}], should_replace: {3}, confidence: {4}'.format(
			self.from_, self.to, ', '.join(self.suggestions), self.should_replace, self.confidence)

class GingerClient(object):
	&quot;&quot;&quot;Ginger Client&quot;&quot;&quot;
	base_url = 'http://services.gingersoftware.com/Ginger/correct/json/GingerTheText'
	api_key = '6ae0c3a0-afdc-4532-a810-82ded0054236'
	def __init__(self, sentence):
		super(GingerClient, self).__init__()
		self.sentence = sentence
	
	def ginger(self):
		self._initialize()
		return self.summary.process()

	def show_detail(self):
		self._initialize()
		self.summary.show_detail()

	def _initialize(self):
		params = {'apiKey':GingerClient.api_key, 'text':self.sentence, 'lang':'US', 'clientVersion':'2.0'}
		response = requests.get(GingerClient.base_url, params=params)
		results = json.loads(response.text)['LightGingerTheTextResult']
		ginger_results = [GingerResult.create_from_json(x) for x in results]
		self.summary = GingerSummary(self.sentence, ginger_results)	

class RephraseClient(object):
	&quot;&quot;&quot;RephraseClient&quot;&quot;&quot;
	base_url = 'http://ro.gingersoftware.com/rephrase/rephrase'
	def __init__(self, sentence):
		super(RephraseClient, self).__init__()
		self.sentence = sentence

	def rephrase(self):
		response = requests.get(RephraseClient.base_url, params={'s': self.sentence})
		results = json.loads(response.text)['Sentences']
		texts = [x['Sentence'] for x in results]
		return texts


</code></pre>

<h3 id="続き-gingerをalfredで使えるようにしてみた-blog-2013-08-04-ginger:e8db02c391b5d454a2a2df2488b5a9be">続き：<a href="/blog/2013/08/04/ginger/">GingerをAlfredで使えるようにしてみた</a></h3>

			</section>
		</article>
	</main>


	<footer role="contentinfo">
		<div class="hr"></div>
		<div class="footer-link">
			<a href="mailto:mono0926@gmail.com" target="_blank">Email</a></span>
			<a href="https://twitter.com/_mono" target="_blank">Twitter</a></span>
			<a href="https://www.facebook.com/mono0926" target="_blank">Facebook</a></span>
			<a href="https://github.com/mono0926" target="_blank">GitHub</a></span>
		</div>
		<div class="copyright">Copyright &copy; Masayuki Ono All right reserved.</div>
	</footer>

</div>

<script>
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-11434295-7', 'auto');
	ga('send', 'pageview');
</script>

<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

</body>
</html>