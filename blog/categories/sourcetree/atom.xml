<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: sourcetree | monoHub]]></title>
  <link href="http://mono0926.github.io/blog/categories/sourcetree/atom.xml" rel="self"/>
  <link href="http://mono0926.github.io/"/>
  <updated>2015-04-16T11:49:58+09:00</updated>
  <id>http://mono0926.github.io/</id>
  <author>
    <name><![CDATA[Masayuki Ono]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[SourceTreeでブランチ名をコミットメッセージの先頭に自動挿入]]></title>
    <link href="http://mono0926.github.io/blog/2014/10/31/sourcetree/"/>
    <updated>2014-10-31T12:36:00+09:00</updated>
    <id>http://mono0926.github.io/blog/2014/10/31/sourcetree</id>
    <content type="html"><![CDATA[<p>Git便利ですね。今やこれ無しで開発は無理、というレベルです。</p>

<p>そんな日々使っているGitですが、何かしらのツールでタスクやIssueを作ってそのIDをfeatureブランチ名としている運用は多いと思います。</p>

<p>その場合、コミットメッセージにそのIDが含まれているとコミットとタスクを紐づけてくれるので、コミットメッセージの先頭にブランチ名を挿入することが多いはずです。</p>

<p>それを打つのが一々面倒だしたまにミスして違うタスクに紐付かれちゃうし、で少し困っていました。</p>

<p>コマンドラインで作業している場合は、以下のようなにGitの<code>prepare-commit-msg</code>フックを利用することで、コミットメッセージ作成時に自動挿入させることが可能です。</p>

<ul>
<li><a href="http://qiita.com/ykyk1218/items/4c17eef472ae8c31991f">Gitでcommitした時にブランチ名をcommitメッセージに自動でいれる &ndash; Qiita</a></li>
</ul>


<p>ただ、SourceTreeで試そうとしたら、動いてくれず、調べたところ非対応のようです。</p>

<ul>
<li><a href="https://answers.atlassian.com/questions/169399/sourcetree-and-git-prepare-commit-msg">SourceTree and git prepare-commit-msg &ndash; Atlassian Answers</a></li>
</ul>


<p><a href="https://twitter.com/yabuchin_y">@yabuchin_y</a>さんに相談したら、<code>commit-msg</code>で書き換えてしまえばいけるのでは？ということで作ってもらえました。</p>

<p>(僕はこの時点で、<code>commit-msg</code>はバリデーションフェーズ的なもので、書き換えは不可能なのでは？と思って諦めてしまいそうでした。)</p>

<h2>設定手順</h2>

<!-- more -->


<h3>コミットメッセージのテンプレートを作成して指定の文章が自動挿入されるようにする</h3>

<p>以下を、特定のレポジトリルートで実行。</p>

<p>```</p>

<h1>$HOME/.gitmessage.txtの置き場所は自由です</h1>

<h1>グローバルな設定としたい場合は、&mdash;globalオプションを付ける</h1>

<p>git config commit.template $HOME/.gitmessage.txt
```</p>

<p>```</p>

<h1>.gitmessage.txtの中身(末尾に半角スペースを入れておくこと推奨)</h1>

<p>[branchname]
```</p>

<p>これで、コミットメッセージ作成時に、<code>[branchname]</code>が先頭に自動挿入されます。</p>

<h3>コミット後に[branchname]がブランチ名へ書き換えられるようにする</h3>

<p><code>commit-msg</code>フックを利用します。</p>

<p>以下を特定のレポジトリの<code>.git/hooks/commit-msg</code>として配置します。</p>

<p>```</p>

<h1>!/usr/bin/env ruby</h1>

<p>message_file = ARGV[0]
message = File.read(message_file, :encoding => Encoding::UTF_8)</p>

<p>current_branch = <code>git branch | grep '*'</code>.chomp.sub(&lsquo;* &rsquo;, &lsquo;&rsquo;)
current_branch = current_branch[current_branch.rindex(&ldquo;/&rdquo;)+1 .. current_branch.length]</p>

<p>newmessage = message.sub(/[branchname]/, current_branch)</p>

<p>File.write(message_file, newmessage)
```</p>

<p><code>feature/hoge/#35</code>などとなっている場合、<code>[branchname]</code>部分が<code>#35</code>と置換されるような処理をしています。
用途に応じて適宜書き換えてください。</p>

<h2>挙動</h2>

<p>文章だけではイメージが沸きにくいかもしれないので、スクリーンショット貼っておきます。</p>

<h3>コミットメッセージを入れようとすると先頭に[branchname]が自動挿入</h3>

<p><img src="/images/post/st1.png" alt="" /></p>

<p>そのままその後にメッセージを入れてコミットします。</p>

<h3>[branchname]が置換されてブランチ名になってくれます</h3>

<p><img src="/images/post/st2.png" alt="" /></p>

<h2>実際に使って見て</h2>

<p>先週から活用し初めましたがすこぶる快適です(　´･‿･｀)</p>

<p><a href="https://twitter.com/yabuchin_y">@yabuchin_y</a>さん、ありがとうございました(　´･‿･｀)</p>

<h3>参考リンク</h3>

<ul>
<li><a href="http://git-scm.com/book/ja/v1/Git-%E3%81%AE%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA-Git-%E3%83%95%E3%83%83%E3%82%AF">Git &ndash; Git フック</a></li>
<li><a href="http://qiita.com/khlizard/items/dfe1ec9d82c0ed5da7c6">Git hooks まとめ &ndash; Qiita</a></li>
</ul>

]]></content>
  </entry>
  
</feed>
